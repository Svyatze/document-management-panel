<!-- features/document/document-list/document-list.component.html -->
<mat-card>
  <mat-card-header>
    <mat-card-title>Documents</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <div class="filter-container">
      <mat-form-field appearance="outline">
        <mat-label>Filter by Status</mat-label>
        <mat-select [value]="currentStatus()" (valueChange)="onStatusChange($event)">
          @for (option of statusOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      @if (!isReviewer()) {
        <button mat-raised-button color="primary" routerLink="/dashboard/documents/new">
          <mat-icon>add</mat-icon>
          Add Document
        </button>
      }
    </div>

    @if (loading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else if (documents().length === 0) {
      <div class="empty-state">
        <mat-icon class="empty-icon">description_off</mat-icon>
        <h3>No documents found</h3>
        <p>
          @if (currentStatus()) {
            Try changing the status filter or create a new document.
          } @else {
            @if (isReviewer()) {
              There are no documents to review at this time.
            } @else {
              Click the "Add Document" button to upload your first document.
            }
          }
        </p>
      </div>
    } @else {
      <div class="table-container">
        <table mat-table [dataSource]="documents()" matSort (matSortChange)="onSortChange($event)">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>File</th>
            <td mat-cell *matCellDef="let document">
              <a [routerLink]="['/dashboard/documents', document.id, 'view']">{{ document.name }}</a>
            </td>
          </ng-container>

          <!-- Creator Column (Only for Reviewer) -->
          <ng-container matColumnDef="creator">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Creator</th>
            <td mat-cell *matCellDef="let document">{{ document.creator?.fullName }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let document">
              <span class="status-chip" [ngClass]="getStatusClass(document.status)">
                {{ document.status }}
              </span>
            </td>
          </ng-container>

          <!-- Updated At Column -->
          <ng-container matColumnDef="updatedAt">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Updated at</th>
            <td mat-cell *matCellDef="let document">{{ document.updatedAt | date:'medium' }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let document">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
                <mat-icon>more_vert</mat-icon>
              </button>

              <mat-menu #menu="matMenu">
                <button mat-menu-item [routerLink]="['/dashboard/documents', document.id, 'view']">
                  <mat-icon>visibility</mat-icon>
                  <span>View</span>
                </button>

                @if (canEdit(document)) {
                  <button mat-menu-item [routerLink]="['/dashboard/documents', document.id, 'edit']">
                    <mat-icon>edit</mat-icon>
                    <span>Edit</span>
                  </button>
                }

                @if (canDelete(document)) {
                  <button mat-menu-item (click)="deleteDocument(document)">
                    <mat-icon color="warn">delete</mat-icon>
                    <span>Delete</span>
                  </button>
                }

                @if (canRevoke(document)) {
                  <button mat-menu-item (click)="revokeDocument(document)">
                    <mat-icon>undo</mat-icon>
                    <span>Revoke</span>
                  </button>
                }

                @if (canChangeStatus(document)) {
                  <mat-divider></mat-divider>
                  <button mat-menu-item [disabled]="document.status === DocumentStatus.IN_REVIEW"
                          (click)="updateStatus(document, DocumentStatus.IN_REVIEW)">
                    <mat-icon>pending_actions</mat-icon>
                    <span>Mark as In Review</span>
                  </button>
                  <button mat-menu-item [disabled]="document.status === DocumentStatus.APPROVED"
                          (click)="updateStatus(document, DocumentStatus.APPROVED)">
                    <mat-icon color="primary">check_circle</mat-icon>
                    <span>Approve</span>
                  </button>
                  <button mat-menu-item [disabled]="document.status === DocumentStatus.REJECTED"
                          (click)="updateStatus(document, DocumentStatus.REJECTED)">
                    <mat-icon color="warn">cancel</mat-icon>
                    <span>Reject</span>
                  </button>
                }
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns();"></tr>
        </table>

        <mat-paginator
          [length]="totalCount()"
          [pageSize]="pageSize()"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [pageIndex]="currentPage()"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    }
  </mat-card-content>
</mat-card>
